#!/bin/bash

echo $MIX_ENV
mkdir -p "$1"/priv/plts
mkdir -p "$2"/plts
SKIP_CACHE="${DIALYXIR_SKIP_CACHE:-false}"

# the -f test supresses warnings when cache is empty
if [ "$SKIP_CACHE" == "true" ]; then
	echo "Ignoring cached PLTs"
else
	[ -f "$2"/plts/dialyzer.plt ] && echo "Resoring cache..." && cp "$2"/plts/* "$1"/priv/plts || echo "Cache empty"
fi

echo "Updating plts"
cd "$1"
MIX_ENV=test mix dialyzer --plt

echo "Caching plts..."
cp "$1"/priv/plts/* "$2"/plts
